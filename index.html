<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Railway Booking Assistant</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #34495e;
            font-weight: 600;
        }

        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
        }

        .voice-input {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .voice-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .voice-btn:hover {
            background: #2980b9;
        }

        .voice-btn.recording {
            background: #e74c3c;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .submit-btn {
            background: #2ecc71;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            width: 100%;
            font-size: 16px;
            font-weight: 600;
            margin-top: 20px;
        }

        .submit-btn:hover {
            background: #27ae60;
        }

        .assistant-container {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .assistant-message {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        #confirmationModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 500px;
            margin: 50px auto;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .modal-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }

        .confirm-btn {
            background: #2ecc71;
            color: white;
        }

        .cancel-btn {
            background: #e74c3c;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Railway Booking Assistant</h1>
        
        <form id="bookingForm">
            <div class="form-group">
                <label for="name">Full Name:</label>
                <div class="voice-input">
                    <input type="text" id="name" name="name" required>
                    <button type="button" class="voice-btn" data-field="name">
                        <span>ðŸŽ¤</span>
                    </button>
                </div>
            </div>

            <div class="form-group">
                <label for="from">From Station:</label>
                <div class="voice-input">
                    <input type="text" id="from" name="from" required>
                    <button type="button" class="voice-btn" data-field="from">
                        <span>ðŸŽ¤</span>
                    </button>
                </div>
            </div>

            <div class="form-group">
                <label for="to">To Station:</label>
                <div class="voice-input">
                    <input type="text" id="to" name="to" required>
                    <button type="button" class="voice-btn" data-field="to">
                        <span>ðŸŽ¤</span>
                    </button>
                </div>
            </div>

            <div class="form-group">
                <label for="date">Travel Date:</label>
                <div class="voice-input">
                    <input type="date" id="date" name="date" required>
                    <button type="button" class="voice-btn" data-field="date">
                        <span>ðŸŽ¤</span>
                    </button>
                </div>
            </div>

            <div class="form-group">
                <label for="passengers">Number of Passengers:</label>
                <div class="voice-input">
                    <input type="number" id="passengers" name="passengers" min="1" max="6" required>
                    <button type="button" class="voice-btn" data-field="passengers">
                        <span>ðŸŽ¤</span>
                    </button>
                </div>
            </div>

            <div class="form-group">
                <label for="class">Class:</label>
                <div class="voice-input">
                    <select id="class" name="class" required>
                        <option value="">Select Class</option>
                        <option value="1A">First AC</option>
                        <option value="2A">Second AC</option>
                        <option value="3A">Third AC</option>
                        <option value="SL">Sleeper</option>
                    </select>
                    <button type="button" class="voice-btn" data-field="class">
                        <span>ðŸŽ¤</span>
                    </button>
                </div>
            </div>

            <button type="submit" class="submit-btn">Book Ticket</button>
        </form>

        <div class="assistant-container">
            <div class="assistant-message">
                Hello! I'm your booking assistant. You can either type or use the microphone buttons to fill the form.
                Need help? Just ask me anything about the booking process!
            </div>
            <div class="voice-input">
                <input type="text" id="userQuery" placeholder="Type your question or click the microphone">
                <button type="button" class="voice-btn" data-field="query">
                    <span>ðŸŽ¤</span>
                </button>
            </div>
        </div>
    </div>

    <div id="confirmationModal">
        <div class="modal-content">
            <h2>Confirm Your Booking</h2>
            <div id="bookingSummary"></div>
            <div class="modal-buttons">
                <button class="modal-btn confirm-btn" onclick="confirmBooking()">Confirm</button>
                <button class="modal-btn cancel-btn" onclick="closeModal()">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        let recognition = null;
        let currentField = null;

        // Initialize speech recognition
        if ('webkitSpeechRecognition' in window) {
            recognition = new webkitSpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'en-US';

            recognition.onresult = (event) => {
                const result = event.results[0][0].transcript;
                if (currentField) {
                    processVoiceInput(result, currentField);
                }
                stopRecording();
            };

            recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                stopRecording();
            };
        }

        // Add event listeners to voice buttons
        document.querySelectorAll('.voice-btn').forEach(button => {
            button.addEventListener('click', () => {
                if (recognition) {
                    currentField = button.dataset.field;
                    startRecording(button);
                } else {
                    alert('Speech recognition is not supported in your browser.');
                }
            });
        });

        function startRecording(button) {
            stopRecording(); // Stop any ongoing recording
            button.classList.add('recording');
            recognition.start();
        }

        function stopRecording() {
            document.querySelectorAll('.voice-btn').forEach(btn => {
                btn.classList.remove('recording');
            });
            if (recognition) {
                recognition.stop();
            }
        }

        function processVoiceInput(text, field) {
            if (field === 'query') {
                handleAssistantQuery(text);
                return;
            }

            const input = document.getElementById(field);
            if (!input) return;

            switch (field) {
                case 'date':
                    // Convert spoken date to date format
                    const dateMatch = text.match(/(\d{1,2})(st|nd|rd|th)?\s+(January|February|March|April|May|June|July|August|September|October|November|December)(?:\s+(\d{4}))?/i);
                    if (dateMatch) {
                        const day = dateMatch[1].padStart(2, '0');
                        const month = new Date(Date.parse(dateMatch[3] + " 1, 2000")).getMonth() + 1;
                        const year = dateMatch[4] || new Date().getFullYear();
                        input.value = `${year}-${month.toString().padStart(2, '0')}-${day}`;
                    }
                    break;

                case 'passengers':
                    // Extract number from speech
                    const num = text.match(/\d+/);
                    if (num) {
                        input.value = Math.min(Math.max(parseInt(num[0]), 1), 6);
                    }
                    break;

                case 'class':
                    // Map spoken class to select options
                    const classMap = {
                        'first ac': '1A',
                        'first class': '1A',
                        'second ac': '2A',
                        'second class': '2A',
                        'third ac': '3A',
                        'third class': '3A',
                        'sleeper': 'SL'
                    };
                    const spokenClass = text.toLowerCase();
                    for (const [key, value] of Object.entries(classMap)) {
                        if (spokenClass.includes(key)) {
                            input.value = value;
                            break;
                        }
                    }
                    break;

                default:
                    input.value = text;
            }
        }

        function handleAssistantQuery(query) {
            query = query.toLowerCase();
            let response = "I'm sorry, I don't understand that question. Can you please rephrase it?";

            // Simple pattern matching for common queries
            if (query.includes('how') && query.includes('book')) {
                response = "To book a ticket, simply fill in all the required fields in the form. You can either type or use the microphone buttons next to each field. Once you're done, click the 'Book Ticket' button.";
            } else if (query.includes('class') || query.includes('classes')) {
                response = "We offer four classes: First AC (1A), Second AC (2A), Third AC (3A), and Sleeper (SL). First AC is the most premium class with private compartments.";
            } else if (query.includes('passenger') || query.includes('passengers')) {
                response = "You can book for up to 6 passengers in a single booking.";
            } else if (query.includes('date') || query.includes('when')) {
                response = "You can book tickets up to 120 days in advance. Simply select your preferred travel date in the date field.";
            }

            document.querySelector('.assistant-message').textContent = response;
        }

        // Form submission handling
        document.getElementById('bookingForm').addEventListener('submit', (e) => {
            e.preventDefault();
            showConfirmation();
        });

        function showConfirmation() {
            const form = document.getElementById('bookingForm');
            const summary = document.getElementById('bookingSummary');
            summary.innerHTML = `
                <p><strong>Name:</strong> ${form.name.value}</p>
                <p><strong>From:</strong> ${form.from.value}</p>
                <p><strong>To:</strong> ${form.to.value}</p>
                <p><strong>Date:</strong> ${form.date.value}</p>
                <p><strong>Passengers:</strong> ${form.passengers.value}</p>
                <p><strong>Class:</strong> ${form.class.options[form.class.selectedIndex].text}</p>
            `;
            document.getElementById('confirmationModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('confirmationModal').style.display = 'none';
        }

        function confirmBooking() {
            alert('Booking confirmed! In a real application, this would be sent to the server.');
            closeModal();
            document.getElementById('bookingForm').reset();
        }

        // Close modal when clicking outside
        window.onclick = (event) => {
            const modal = document.getElementById('confirmationModal');
            if (event.target === modal) {
                closeModal();
            }
        };
    </script>
</body>
</html>